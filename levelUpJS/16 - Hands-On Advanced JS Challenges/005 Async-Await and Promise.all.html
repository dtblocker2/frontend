<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Coding Assignment</title>

        <style>
            body {
                font-family: sf pro text, -apple-system, BlinkMacSystemFont, Roboto, segoe ui, Helvetica, Arial,
                    sans-serif, apple color emoji, segoe ui emoji, segoe ui symbol;
                font-weight: 400;
                line-height: 22.4px;
                font-size: 16px;
            }
            p,
            ul,
            ol {
                font-size: 16px;
                font-weight: 400;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6 {
                font-weight: bold;
            }
            ul {
                list-style: none;
                margin: 0;
                padding: 0;
                max-width: none;
            }
            .code-snippet {
                background-color: #fff;
                border: 1px solid #d1d7dc;
                color: #b4690e;
                font-size: 90%;
                padding: 0.2rem 0.4rem;
            }
            .code-block {
                background-color: #fff;
                color: #b4690e;
                font-size: 90%;
            }
            .black-block {
                color: #000000;
            }
            .italic-text {
                font-style: italic;
            }
        </style>
    </head>

    <body onload="main()">
        <h1 id="coding-title"></h1>
        <div>
            <h2>Instructions</h2>
            <div id="coding-instructions"></div>
        </div>
        <div>
            <h2>Test(s)</h2>
            <div id="coding-tests"></div>
        </div>
        <div>
            <h2>Solution(s)</h2>
            <div id="coding-solutions"></div>
        </div>

        <script>
            const quizData = {"title": "005 Async-Await and Promise.all", "hasInstructions": true, "hasTests": true, "hasSolutions": true, "instructions": "<p><strong>Task 1: Async-Await with Promise.all</strong></p><p>Create two functions <code>fetchUser()</code> and <code>fetchPosts()</code>, both returning promises that resolve in 1 second. </p><p>Use async-await and Promise.all to fetch both simultaneously and log the results as part of <code>fetchAllData()</code></p><p><br></p><p><strong>Task 2: Error Handling in Async/Await with Promise.all</strong></p><p>Write two functions <code>fetchSuccess()</code> and <code>fetchFailure()</code>, where fetchSuccess() returns a promise that resolves successfully after 1 second, and fetchFailure() returns a promise that rejects with an error after 1 second.</p><p>Create a function <code>handlePromises()</code> that calls both functions using Promise.all and handles success and failure cases.</p><p><br></p><p><strong>Task 3: Timeout with Async/Await and Promise.race</strong></p><p>Create a function <code>fetchWithTimeout(promise, timeout)</code> that takes a promise and a timeout value in milliseconds. Use Promise.race() to return the result of the promise if it resolves within the timeout, otherwise return \"<em>Timeout exceeded</em>\".</p>", "tests": [{"file_name": "evaluate.js", "content": "describe('fetchAllData', function() {\n  beforeEach(function() {\n    spyOn(console, 'log'); // Spy on console.log before the function call\n  });\n\n  it('should fetch user and posts data simultaneously using Promise.all', function(done) {\n    fetchAllData().then(function() {\n      expect(console.log.calls.argsFor(0)).toEqual(['User data']);\n      expect(console.log.calls.argsFor(1)).toEqual(['Posts data']);\n      done(); // Mark async test as done\n    }).catch(function(error) {\n      done.fail(error); // In case of any error\n    });\n  });\n\n  afterEach(function() {\n    jasmine.DEFAULT_TIMEOUT_INTERVAL = 10000; // Optionally increase the timeout for async calls\n  });\n});\n\ndescribe('Error Handling in Async/Await with Promise.all', function() {\n  beforeEach(function() {\n    spyOn(console, 'log'); // Spy on console.log\n  });\n\n  it('should handle error from one of the promises in Promise.all', function(done) {\n    handlePromises().then(function() {\n      expect(console.log.calls.argsFor(0)).toEqual(['Error occurred']);\n      done();\n    });\n  });\n});\n\ndescribe('Timeout with Async/Await and Promise.race', function() {\n  it('should resolve the promise if it completes before the timeout', function(done) {\n    fetchWithTimeout(fetchData(), 4000).then(function(result) {\n      expect(result).toBe('Data fetched');\n      done();\n    });\n  });\n\n  it('should return a timeout message if the promise takes too long', function(done) {\n    fetchWithTimeout(fetchData(), 2000).catch(function(error) {\n      expect(error).toBe('Timeout exceeded');\n      done();\n    });\n  });\n});"}], "solutions": [{"file_name": "index.js", "content": "// Task 1\nfunction fetchUser() {\n  return new Promise(resolve => setTimeout(() => resolve('User data'), 1000));\n}\n\nfunction fetchPosts() {\n  return new Promise(resolve => setTimeout(() => resolve('Posts data'), 1000));\n}\n\nasync function fetchAllData() {\n  const [user, posts] = await Promise.all([fetchUser(), fetchPosts()]);\n  console.log(user);\n  console.log(posts);\n}\n\n// Task 2\nfunction fetchSuccess() {\n  return new Promise(resolve => setTimeout(() => resolve('Success'), 1000));\n}\n\nfunction fetchFailure() {\n  return new Promise((_, reject) => setTimeout(() => reject('Error occurred'), 1000));\n}\n\nasync function handlePromises() {\n  try {\n    const [success, failure] = await Promise.all([fetchSuccess(), fetchFailure()]);\n    console.log(success);\n  } catch (error) {\n    console.log(error);\n  }\n}\n\n// Task 3\nfunction fetchWithTimeout(promise, timeout) {\n  const timeoutPromise = new Promise((_, reject) => \n    setTimeout(() => reject('Timeout exceeded'), timeout)\n  );\n  \n  return Promise.race([promise, timeoutPromise]);\n}\n\nfunction fetchData() {\n  return new Promise(resolve => setTimeout(() => resolve('Data fetched'), 3000));\n}\n"}]};

            function renderCodeList(rootElement, codeList, className, titlePrefix) {
                for (var i = 0; i < codeList.length; i++) {
                    var elem = codeList[i];
                    var jsElem = document.createElement("div");
                    jsElem.className = className;
                    var jsElemTitle = document.createElement("h3");
                    jsElemTitle.innerHTML = titlePrefix + " " + (i + 1);
                    var jsElemBody = document.createElement("code");
                    jsElemBody.className = "code-block black-block";
                    jsElemBody.innerHTML = "<pre>" + elem.content + "</pre>";
                    jsElem.appendChild(jsElemTitle);
                    jsElem.appendChild(jsElemBody);
                    rootElement.appendChild(jsElem);
                }
            }

            function main() {
                // display the assignment
                var codingTitle = document.getElementById("coding-title");
                codingTitle.innerHTML = quizData.title;

                var codingInstructions = document.getElementById("coding-instructions");
                if (quizData.hasInstructions) {
                    codingInstructions.innerHTML = quizData.instructions;
                } else {
                    codingInstructions.innerHTML = '<span class="italic-text">' + quizData.instructions + "</span>";
                }

                // display the test(s)
                var codingTests = document.getElementById("coding-tests");
                if (!quizData.hasTests) {
                    codingTests.innerHTML = '<span class="italic-text">' + quizData.tests + "</span>";
                } else {
                    renderCodeList(codingTests, quizData.tests, "coding-test", "Test");
                }

                // display the solution(s)
                var codingSolutions = document.getElementById("coding-solutions");
                if (!quizData.hasSolutions) {
                    codingSolutions.innerHTML = '<span class="italic-text">' + quizData.solutions + "</span>";
                } else {
                    renderCodeList(codingSolutions, quizData.solutions, "coding-solution", "Solution");
                }
            }
        </script>
    </body>
</html>
